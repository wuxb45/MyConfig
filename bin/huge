#!/bin/bash

thp="/sys/kernel/mm/transparent_hugepage/enabled"
echo "${thp}  --  $(cat ${thp})"

SYSROOT="/sys/kernel/mm"
NODEROOT="/sys/devices/system/node"
for path in ${SYSROOT} ${NODEROOT}/node*; do
  for hugesize in 2048kB 1048576kB; do
    h="${path}/hugepages/hugepages-${hugesize}"
    if [[ ! -f ${h}/nr_hugepages || ! -f ${h}/free_hugepages ]]; then
      continue
    fi
    nr=$(cat ${h}/nr_hugepages)
    nf=$(cat ${h}/free_hugepages)
    echo "${h}  --  nr ${nr} free ${nf}"
  done
done
